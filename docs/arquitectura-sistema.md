# ğŸ—ï¸ Arquitectura del Sistema - KPI Dashboard ECOPLAST

## ğŸ“ Vista General de Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CAPA DE PRESENTACIÃ“N                         â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Desktop    â”‚  â”‚   Tablet     â”‚  â”‚   Mobile     â”‚             â”‚
â”‚  â”‚   Browser    â”‚  â”‚   Browser    â”‚  â”‚   Browser    â”‚             â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚             â”‚
â”‚  â”‚  Chrome/Edge â”‚  â”‚    Safari    â”‚  â”‚   Chrome     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                  â”‚                  â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                            â”‚                                         â”‚
â”‚                            â”‚ HTTPS                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CAPA DE APLICACIÃ“N WEB                         â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Laravel 12.37.0                            â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚  â”‚   Routes    â”‚  â”‚ Controllers â”‚  â”‚    Views    â”‚         â”‚ â”‚
â”‚  â”‚  â”‚  web.php    â”‚â†’ â”‚             â”‚â†’ â”‚   Blade     â”‚         â”‚ â”‚
â”‚  â”‚  â”‚  api.php    â”‚  â”‚  - User     â”‚  â”‚ - Dashboard â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ channels.phpâ”‚  â”‚  - Equipmentâ”‚  â”‚ - Equipment â”‚         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - Productionâ”‚ â”‚ - Productionâ”‚         â”‚ â”‚
â”‚  â”‚                   â”‚  - Quality  â”‚  â”‚ - Quality   â”‚         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  - Downtime â”‚  â”‚ - Downtime  â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ Middleware  â”‚  â”‚  - Report   â”‚  â”‚ - Reports   â”‚         â”‚ â”‚
â”‚  â”‚  â”‚             â”‚  â”‚  - Audit    â”‚  â”‚ - Audit     â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ - Auth      â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â”‚  â”‚ - CSRF      â”‚        â”‚                                   â”‚ â”‚
â”‚  â”‚  â”‚ - Sanctum   â”‚        â”‚                                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                   â”‚ â”‚
â”‚  â”‚                         â”‚                                   â”‚ â”‚
â”‚  â”‚                         â–¼                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚
â”‚  â”‚  â”‚         CAPA DE LÃ“GICA                â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚                                       â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Models    â”‚  â”‚   Services   â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚             â”‚  â”‚              â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - User      â”‚  â”‚ - KpiService â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - Role      â”‚  â”‚   â€¢ calcOEE  â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - Permissionâ”‚  â”‚   â€¢ calcAvailâ”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - Equipment â”‚  â”‚   â€¢ calcPerf â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - Productionâ”‚  â”‚   â€¢ calcQual â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - Quality   â”‚  â”‚              â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - Downtime  â”‚  â”‚              â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - AuditLog  â”‚  â”‚              â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚                                      â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Events & Listeners         â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                              â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - KpiUpdated                â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - ProductionDataUpdated     â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â†’ Pusher Broadcast        â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚                                      â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Traits                     â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                              â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ - AuthorizesPermissions     â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â€¢ authorizePermission()   â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚                   â”‚
         â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MYSQL DB      â”‚ â”‚  Pusher Service â”‚ â”‚   File Storage  â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ - users         â”‚ â”‚ - WebSocket     â”‚ â”‚ - Logs          â”‚
â”‚ - roles         â”‚ â”‚ - Real-time     â”‚ â”‚ - Reports PDF   â”‚
â”‚ - permissions   â”‚ â”‚   broadcast     â”‚ â”‚ - Uploads       â”‚
â”‚ - user_permiss. â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ - equipment     â”‚ â”‚ Channel:        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - production    â”‚ â”‚ kpi-channel     â”‚
â”‚ - quality       â”‚ â”‚                 â”‚
â”‚ - downtime      â”‚ â”‚ Events:         â”‚
â”‚ - audit_logs    â”‚ â”‚ - production-   â”‚
â”‚                 â”‚ â”‚   data-updated  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ - kpi-updated   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Arquitectura de Base de Datos

### Diagrama Entidad-RelaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USUARIOS Y PERMISOS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    users     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)      â”‚
    â”‚ name         â”‚
    â”‚ email        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ password     â”‚         â”‚
    â”‚ role_id (FK) â”‚â”€â”€â”€â”€â”€â”   â”‚
    â”‚ is_active    â”‚     â”‚   â”‚
    â”‚ created_at   â”‚     â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
            â”‚            â”‚   â”‚
            â”‚ 1:N        â”‚   â”‚
            â”‚            â”‚   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
    â”‚   audit_logs     â”‚ â”‚   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚
    â”‚ id (PK)          â”‚ â”‚   â”‚
    â”‚ user_id (FK)     â”‚ â”‚   â”‚
    â”‚ action           â”‚ â”‚   â”‚
    â”‚ model_type       â”‚ â”‚   â”‚
    â”‚ model_id         â”‚ â”‚   â”‚
    â”‚ old_values (JSON)â”‚ â”‚   â”‚
    â”‚ new_values (JSON)â”‚ â”‚   â”‚
    â”‚ ip_address       â”‚ â”‚   â”‚
    â”‚ user_agent       â”‚ â”‚   â”‚
    â”‚ created_at       â”‚ â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
                         â”‚   â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â–¼â”€â”€â”€â”€â”
                    â”‚    roles    â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ id (PK)     â”‚
                    â”‚ name        â”‚
                    â”‚ description â”‚
                    â”‚ created_at  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ N:M
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   role_permission       â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ role_id (FK)            â”‚
              â”‚ permission_id (FK)      â”‚
              â”‚ PRIMARY KEY (role, perm)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚
       â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ permissions  â”‚              â”‚ user_permission  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚              â”‚ user_id (FK)     â”‚
â”‚ name         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ permission_id(FK)â”‚
â”‚ description  â”‚              â”‚ UNIQUE(user,perm)â”‚
â”‚ category     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ created_at   â”‚                     â–²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                     â”‚
                        PERMISOS PERSONALIZADOS
                        (Override de rol)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EQUIPOS Y PRODUCCIÃ“N                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   equipment      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)          â”‚
    â”‚ name             â”‚
    â”‚ code (UNIQUE)    â”‚
    â”‚ type             â”‚
    â”‚ capacity         â”‚
    â”‚ is_active        â”‚
    â”‚ created_at       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 1:N
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                              â”‚
    â”‚                                              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ production_data   â”‚  â”‚  quality_data    â”‚  â”‚  downtime_data    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)           â”‚  â”‚ id (PK)          â”‚  â”‚ id (PK)           â”‚
â”‚ equipment_id (FK) â”‚  â”‚ equipment_id(FK) â”‚  â”‚ equipment_id (FK) â”‚
â”‚ date              â”‚  â”‚ inspection_date  â”‚  â”‚ start_time        â”‚
â”‚ start_time        â”‚  â”‚ inspector_name   â”‚  â”‚ end_time          â”‚
â”‚ end_time          â”‚  â”‚ units_inspected  â”‚  â”‚ duration_minutes  â”‚
â”‚ units_produced    â”‚  â”‚ units_approved   â”‚  â”‚ reason            â”‚
â”‚ defective_units   â”‚  â”‚ units_rejected   â”‚  â”‚ category          â”‚
â”‚ operating_time    â”‚  â”‚ defect_type      â”‚  â”‚ - planificado     â”‚
â”‚ oee               â”‚  â”‚ quality_rate     â”‚  â”‚ - no planificado  â”‚
â”‚ availability      â”‚  â”‚ defect_rate      â”‚  â”‚ description       â”‚
â”‚ performance       â”‚  â”‚ notes            â”‚  â”‚ created_at        â”‚
â”‚ quality           â”‚  â”‚ created_at       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ created_at        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ãndices Clave

```sql
-- OptimizaciÃ³n de consultas frecuentes

-- BÃºsqueda de producciÃ³n por equipo y fecha
CREATE INDEX idx_production_equipment_date 
ON production_data(equipment_id, date);

-- Filtro de calidad por equipo y fecha
CREATE INDEX idx_quality_equipment_date 
ON quality_data(equipment_id, inspection_date);

-- AnÃ¡lisis de downtime por categorÃ­a
CREATE INDEX idx_downtime_category 
ON downtime_data(equipment_id, category, start_time);

-- AuditorÃ­a por usuario y acciÃ³n
CREATE INDEX idx_audit_user_action 
ON audit_logs(user_id, action, created_at);

-- BÃºsqueda de permisos personalizados
CREATE UNIQUE INDEX idx_user_permission_unique 
ON user_permission(user_id, permission_id);
```

---

## ğŸ” Arquitectura de Seguridad

### Sistema de Permisos en Cascada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIO AUTENTICADO                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Â¿Tiene Custom        â”‚
              â”‚ Permissions?         â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ NO    â”‚ SI
                     â”‚       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚
            â”‚ Usar        â”‚  â”‚
            â”‚ Permisos    â”‚  â”‚
            â”‚ del Rol     â”‚  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
                     â”‚       â”‚
                     â”‚       â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  â”‚ Usar SOLO       â”‚
                     â”‚  â”‚ Custom          â”‚
                     â”‚  â”‚ Permissions     â”‚
                     â”‚  â”‚ (Override)      â”‚
                     â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚
                                          â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ hasPermission()   â”‚
                              â”‚ verifica:         â”‚
                              â”‚ "production.view" â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ NO                  â”‚ SI
                           â–¼                     â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ abort(403)      â”‚   â”‚ Continuar       â”‚
                  â”‚ "No tienes      â”‚   â”‚ ejecuciÃ³n       â”‚
                  â”‚  permiso..."    â”‚   â”‚                 â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ProtecciÃ³n en Dos Capas

```
CAPA 1: VISTA (Blade Template)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @if(auth()->user()                  â”‚
â”‚     ->hasPermission('production.    â”‚
â”‚      create'))                      â”‚
â”‚   <button>Registrar</button>        â”‚
â”‚ @endif                              â”‚
â”‚                                     â”‚
â”‚ Resultado:                          â”‚
â”‚ âœ… Con permiso: BotÃ³n visible       â”‚
â”‚ âŒ Sin permiso: BotÃ³n oculto        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Usuario intenta URL directo:
                â”‚ POST /production
                â”‚
                â–¼
CAPA 2: CONTROLADOR
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ public function store(Request $req) â”‚
â”‚ {                                   â”‚
â”‚   $this->authorizePermission(       â”‚
â”‚     'production.create',            â”‚
â”‚     'No tienes permiso...'          â”‚
â”‚   );                                â”‚
â”‚                                     â”‚
â”‚   // LÃ³gica...                      â”‚
â”‚ }                                   â”‚
â”‚                                     â”‚
â”‚ Resultado:                          â”‚
â”‚ âœ… Con permiso: Ejecuta             â”‚
â”‚ âŒ Sin permiso: abort(403)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ Arquitectura de ComunicaciÃ³n en Tiempo Real

### Flujo WebSocket con Pusher

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EVENTO DE PRODUCCIÃ“N                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 1. Usuario registra producciÃ³n
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ProductionController â”‚
              â”‚   ::store()          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 2. Guardar en DB
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ProductionData       â”‚
              â”‚   ::create($data)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 3. Disparar evento
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ProductionDataUpdated    â”‚
              â”‚   ::dispatch($production)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 4. Broadcasting
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Pusher API               â”‚
              â”‚ Channel: kpi-channel     â”‚
              â”‚ Event: production-data-  â”‚
              â”‚        updated           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 5. Broadcast
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario A  â”‚  â”‚ Usuario B  â”‚  â”‚ Usuario C  â”‚
â”‚ Dashboard  â”‚  â”‚ Reportes   â”‚  â”‚ Mobile App â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚               â”‚               â”‚
       â”‚ 6. RecepciÃ³n JavaScript       â”‚
       â”‚               â”‚               â”‚
       â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Echo.channel('kpi-channel')                â”‚
â”‚   .listen('ProductionDataUpdated',         â”‚
â”‚     (e) => {                               â”‚
â”‚       updateOEEChart(e.production);        â”‚
â”‚       updateDataTable(e.production);       â”‚
â”‚       showNotification('Nueva producciÃ³n');â”‚
â”‚     });                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. ActualizaciÃ³n UI
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOM Actualizado (SIN refrescar pÃ¡gina)     â”‚
â”‚ - GrÃ¡fico OEE recalculado                  â”‚
â”‚ - Tabla con nuevo registro                 â”‚
â”‚ - Badge de notificaciÃ³n +1                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Latencia Total:** 100-300ms desde evento hasta UI

---

## ğŸ¨ Arquitectura de Frontend

### Stack TecnolÃ³gico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FRONTEND ASSETS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tailwind    â”‚  â”‚   Alpine.js  â”‚  â”‚  Chart.js    â”‚
â”‚    CSS       â”‚  â”‚              â”‚  â”‚              â”‚
â”‚              â”‚  â”‚  - Reactive  â”‚  â”‚  - OEE Graph â”‚
â”‚  - Utility   â”‚  â”‚  - x-data    â”‚  â”‚  - Trend     â”‚
â”‚  - Custom    â”‚  â”‚  - x-show    â”‚  â”‚  - Pareto    â”‚
â”‚  - Dark mode â”‚  â”‚  - @click    â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Laravel Mix / Vite  â”‚
              â”‚   - CompilaciÃ³n       â”‚
              â”‚   - MinificaciÃ³n      â”‚
              â”‚   - OptimizaciÃ³n      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  public/build/        â”‚
              â”‚  - app.css            â”‚
              â”‚  - app.js             â”‚
              â”‚  - manifest.json      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Componentes Blade Reutilizables

```
resources/views/
â”‚
â”œâ”€â”€ layouts/
â”‚   â”œâ”€â”€ app.blade.php           (Master layout)
â”‚   â”œâ”€â”€ navigation.blade.php    (Sidebar con permisos)
â”‚   â””â”€â”€ footer.blade.php
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ alert.blade.php         (Success/Error msgs)
â”‚   â”œâ”€â”€ modal.blade.php         (Confirmaciones)
â”‚   â”œâ”€â”€ table.blade.php         (Tablas data)
â”‚   â”œâ”€â”€ chart.blade.php         (GrÃ¡ficos KPI)
â”‚   â””â”€â”€ permission-badge.blade.php
â”‚
â”œâ”€â”€ dashboard.blade.php         (Vista principal)
â”‚
â”œâ”€â”€ equipment/
â”‚   â”œâ”€â”€ index.blade.php         (Lista equipos)
â”‚   â”œâ”€â”€ create.blade.php        (Formulario nuevo)
â”‚   â””â”€â”€ edit.blade.php          (Formulario editar)
â”‚
â”œâ”€â”€ production/
â”‚   â”œâ”€â”€ index.blade.php         (Registros producciÃ³n)
â”‚   â””â”€â”€ create.blade.php
â”‚
â”œâ”€â”€ quality/
â”‚   â”œâ”€â”€ index.blade.php         (Inspecciones)
â”‚   â””â”€â”€ create.blade.php
â”‚
â”œâ”€â”€ downtime/
â”‚   â”œâ”€â”€ index.blade.php         (Tiempos muertos)
â”‚   â””â”€â”€ create.blade.php
â”‚
â”œâ”€â”€ reports/
â”‚   â”œâ”€â”€ index.blade.php         (Selector reportes)
â”‚   â”œâ”€â”€ oee.blade.php           (Reporte OEE)
â”‚   â””â”€â”€ custom.blade.php        (Personalizado)
â”‚
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ index.blade.php         (GestiÃ³n usuarios)
â”‚   â”œâ”€â”€ create.blade.php
â”‚   â”œâ”€â”€ edit.blade.php          (Con permisos custom)
â”‚   â””â”€â”€ show.blade.php
â”‚
â””â”€â”€ audit/
    â”œâ”€â”€ index.blade.php         (Logs auditorÃ­a)
    â””â”€â”€ show.blade.php          (Detalle log)
```

---

## ğŸš€ Arquitectura de Despliegue

### Servidor de ProducciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SERVIDOR LINUX                            â”‚
â”‚                     (Ubuntu 22.04 LTS)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx      â”‚  â”‚   PHP-FPM    â”‚  â”‚   MySQL 8    â”‚
â”‚   (Web       â”‚â†’ â”‚   (8.2)      â”‚â†’ â”‚              â”‚
â”‚    Server)   â”‚  â”‚              â”‚  â”‚ - DB: kpi    â”‚
â”‚              â”‚  â”‚ - Laravel    â”‚  â”‚ - User: kpi  â”‚
â”‚ - Port 80    â”‚  â”‚ - Composer   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - Port 443   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ (SSL)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Supervisor (Process Manager)            â”‚
â”‚                                                      â”‚
â”‚  - Laravel Queue Worker                              â”‚
â”‚    (procesa jobs en background)                      â”‚
â”‚                                                      â”‚
â”‚  - Laravel Horizon                                   â”‚
â”‚    (monitoreo de colas)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Servicios Externos                â”‚
â”‚                                                      â”‚
â”‚  - Pusher (WebSocket broadcasting)                   â”‚
â”‚  - SMTP Server (notificaciones email)               â”‚
â”‚  - Cloudflare (CDN + DDoS protection)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rutas de la AplicaciÃ³n

```
/var/www/kpi-dashboard/
â”‚
â”œâ”€â”€ app/                    (CÃ³digo aplicaciÃ³n)
â”œâ”€â”€ bootstrap/              (InicializaciÃ³n)
â”œâ”€â”€ config/                 (ConfiguraciÃ³n)
â”œâ”€â”€ database/               (Migraciones, seeders)
â”œâ”€â”€ public/                 (RaÃ­z web - DocumentRoot)
â”‚   â”œâ”€â”€ index.php          (Entry point)
â”‚   â””â”€â”€ build/             (Assets compilados)
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ css/               (Tailwind source)
â”‚   â”œâ”€â”€ js/                (JavaScript + Echo)
â”‚   â””â”€â”€ views/             (Blade templates)
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ web.php            (Rutas web)
â”‚   â”œâ”€â”€ api.php            (API REST)
â”‚   â””â”€â”€ channels.php       (Broadcasting)
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ app/               (Uploads)
â”‚   â”œâ”€â”€ framework/         (Cache, sessions)
â”‚   â””â”€â”€ logs/              (Log files)
â”œâ”€â”€ vendor/                (Dependencias Composer)
â”œâ”€â”€ .env                   (ConfiguraciÃ³n ambiente)
â”œâ”€â”€ composer.json
â””â”€â”€ package.json
```

---

## ğŸ“Š Arquitectura de CÃ¡lculo KPI

### Motor de KPIs (KpiService)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    app/Services/KpiService.php                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  calculateOEE($equipmentId, $startDate, $endDate)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Obtener datos de producciÃ³n                         â”‚ â”‚
â”‚  â”‚     - ProductionData::where(...)                         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  2. Calcular Disponibilidad                             â”‚ â”‚
â”‚  â”‚     Disponibilidad = (Tiempo Operativo / Tiempo         â”‚ â”‚
â”‚  â”‚                       Planificado) Ã— 100                â”‚ â”‚
â”‚  â”‚     - Tiempo Planificado = turnos programados           â”‚ â”‚
â”‚  â”‚     - Tiempo Operativo = Planificado - Downtime         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  3. Calcular Rendimiento                                â”‚ â”‚
â”‚  â”‚     Rendimiento = (ProducciÃ³n Real / ProducciÃ³n Ideal)  â”‚ â”‚
â”‚  â”‚                    Ã— 100                                â”‚ â”‚
â”‚  â”‚     - ProducciÃ³n Ideal = Capacidad Ã— Tiempo Operativo   â”‚ â”‚
â”‚  â”‚     - ProducciÃ³n Real = units_produced                  â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  4. Calcular Calidad                                    â”‚ â”‚
â”‚  â”‚     Calidad = (Unidades Buenas / Unidades Totales)      â”‚ â”‚
â”‚  â”‚                Ã— 100                                    â”‚ â”‚
â”‚  â”‚     - Buenas = Totales - Defectuosas                    â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  5. Calcular OEE                                        â”‚ â”‚
â”‚  â”‚     OEE = (Disponibilidad Ã— Rendimiento Ã— Calidad)      â”‚ â”‚
â”‚  â”‚            / 10000                                      â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  Ejemplo:                                               â”‚ â”‚
â”‚  â”‚  OEE = (93.75% Ã— 95% Ã— 96.84%) / 10000                  â”‚ â”‚
â”‚  â”‚      = (93.75 Ã— 95 Ã— 96.84) / 10000                     â”‚ â”‚
â”‚  â”‚      = 862,518.75 / 10000                               â”‚ â”‚
â”‚  â”‚      = 86.25%                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  getEquipmentOEETrend($equipmentId, $days = 7)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Retorna array de OEE por dÃ­a:                          â”‚ â”‚
â”‚  â”‚  [                                                       â”‚ â”‚
â”‚  â”‚    '2025-11-04' => 85.2,                                â”‚ â”‚
â”‚  â”‚    '2025-11-05' => 87.1,                                â”‚ â”‚
â”‚  â”‚    '2025-11-06' => 83.9,                                â”‚ â”‚
â”‚  â”‚    ...                                                   â”‚ â”‚
â”‚  â”‚  ]                                                       â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  Usado para grÃ¡ficos de tendencia                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Arquitectura de Jobs y Colas

### Sistema de Tareas en Background

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     QUEUE ARCHITECTURE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Trigger Event   â”‚
                    â”‚  (Usuario acciÃ³n)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Dispatch Job     â”‚
                    â”‚ to Queue         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Redis / Database Queue   â”‚
              â”‚ - job_id                 â”‚
              â”‚ - payload                â”‚
              â”‚ - attempts               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Queue Worker             â”‚
              â”‚ (php artisan queue:work) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Process Job              â”‚
              â”‚ - Generar PDF            â”‚
              â”‚ - Enviar email           â”‚
              â”‚ - Calcular estadÃ­sticas  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ OK             â”‚ FAIL
                 â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Job        â”‚   â”‚ Retry (3x max) â”‚
        â”‚ Completed  â”‚   â”‚ Failed Jobs    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ MÃ©tricas de Performance

### Objetivos de Performance

| MÃ©trica | Objetivo | Actual |
|---------|----------|--------|
| Tiempo carga dashboard | < 1s | ~800ms |
| CÃ¡lculo OEE | < 50ms | ~35ms |
| GeneraciÃ³n PDF | < 3s | ~2.1s |
| Latencia WebSocket | < 200ms | ~150ms |
| Query DB promedio | < 100ms | ~45ms |
| Usuarios concurrentes | 50 | Probado: 30 |

### Optimizaciones Implementadas

1. **Eager Loading** - Evita N+1 queries
2. **Ãndices DB** - BÃºsquedas optimizadas
3. **Cache de KPIs** - Redis para datos frecuentes
4. **CDN** - Assets estÃ¡ticos en Cloudflare
5. **CompresiÃ³n Gzip** - Nginx compresiÃ³n activa
6. **Lazy Loading** - Componentes bajo demanda

---

**Fin del Documento** ğŸ—ï¸
